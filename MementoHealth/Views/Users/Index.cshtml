@model IEnumerable<MementoHealth.Models.UserViewModel>

@{
    ViewBag.Title = "User Manager";
}

<h2>@ViewBag.Title</h2>

@if (TempData["StatusMessage"] != null)
{
    <p class="text-info">@TempData["StatusMessage"]</p>
}

<p>
    @Html.ActionLink("Create User", "Create")
</p>
<table class="table">
    <tr>
        <th>Full Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>@item.FullName</td>
            <td>@item.Email</td>
            <td>@item.Phone</td>
            <td>@item.Role</td>
            <td>@item.LockOutStatus @(item.EmailConfirmed ? "" : " + Email not confirmed")</td>
            <td>
                @if (User.Identity.Name.ToLower().Equals(item.Email.ToLower()))
                {
                    <text>@Html.ActionLink("Manage current user", "Index", "Manage")</text>
                }
                else
                { // Hide actions for the current user.
                    <text>
                        @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                        @Html.ActionLink("Details", "Details", new { id = item.Id })
                        @if (!item.EmailConfirmed)
                        {
                            <text>|</text>
                            using (Html.BeginForm("ResendEmailConfirmation", "Users", new { id = item.Id }, FormMethod.Post, new { @class = "d-inline" }))
                            {
                                @Html.AntiForgeryToken()
                                <a href="#" onclick="this.closest('form').submit();return false;">Resend Email Confirmation</a>
                            }
                        }
                        <text>|</text>
                        @using (Html.BeginForm("LockUnlock", "Users", new { id = item.Id, lockOut = !item.LockedOut }))
                        {
                            @Html.AntiForgeryToken()
                            <a href="#" onclick="this.closest('form').submit();return false;">@(item.LockedOut ? "Unlock" : "Lock")</a>
                        }
                        |
                        @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                    </text>
                }
            </td>
        </tr>
    }
</table>